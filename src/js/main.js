var listHubs = [
    {
      "long": "-79.86866354942322",
      "lat": "43.256316859398744",
      "name": "Gore Park",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86674308776855",
      "lat": "43.26181945279216",
      "name": "James North at Mulberry",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86361294984816",
      "lat": "43.25911119199103",
      "name": "Seedworks",
      "desc": "Outside SoBi Hamilton Office",
      "haskiosk": "No"
    },
    {
      "long": "-79.95041996240616",
      "lat": "43.26567898015789",
      "name": "Cootes at York and King",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9426434441838",
      "lat": "43.2595496051254",
      "name": "Osler at Grant",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.93979036808014",
      "lat": "43.25205234935895",
      "name": "Main at Whitney",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9342255404988",
      "lat": "43.2572539435115",
      "name": "Osler at Main",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9354198942367",
      "lat": "43.2518522355378",
      "name": "Whitney at Lower Horning",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.92979913949966",
      "lat": "43.25875372772543",
      "name": "Sanders at Binkley",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9264810904732",
      "lat": "43.2599031676959",
      "name": "Sanders at Hollywood",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9092948353051",
      "lat": "43.2605367847852",
      "name": "King at Cline",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9133658840373",
      "lat": "43.2622271626907",
      "name": "Sterling at Whitton",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91026729345322",
      "lat": "43.26202552179778",
      "name": "Sterling at Haddon",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.90359663963316",
      "lat": "43.262715994377196",
      "name": "Westdale Library",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9222158171462",
      "lat": "43.2521423210113",
      "name": "Emerson at Whitney",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9208028150996",
      "lat": "43.2546745875963",
      "name": "Rail Trail at Emerson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.90508794784544",
      "lat": "43.26201477888108",
      "name": "Westdale Village",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9166152756283",
      "lat": "43.2535916384655",
      "name": "Rail Trail at Stroud",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.90785866975784",
      "lat": "43.2585671813327",
      "name": "Main at Columbia College",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9009418422827",
      "lat": "43.2630174571678",
      "name": "Longwood at King",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8993094512",
      "lat": "43.2662112220324",
      "name": "Longwood at Edgevale",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.90823779724",
      "lat": "43.2460802627748",
      "name": "Chedoke Stairs",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9024303171158",
      "lat": "43.2588992373017",
      "name": "Main at Longwood",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8964982026467",
      "lat": "43.2621672804245",
      "name": "Macklin at King",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9011692404747",
      "lat": "43.25656885270854",
      "name": "McMaster Innovation Park",
      "desc": "Large sign removed. \r\n",
      "haskiosk": "No"
    },
    {
      "long": "-79.8947787566411",
      "lat": "43.2465214141618",
      "name": "Dundurn Stairs",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.89265590906143",
      "lat": "43.251458458948996",
      "name": "Dundurn at Aberdeen",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8909067737901",
      "lat": "43.2548127612063",
      "name": "Dundurn St S",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8892092704773",
      "lat": "43.25966301112219",
      "name": "Main at Dundurn",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.88798081874847",
      "lat": "43.26240933566922",
      "name": "King at Dundurn",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.886746253805",
      "lat": "43.2533465230541",
      "name": "Charlton at Locke",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.88510146737099",
      "lat": "43.256556155396176",
      "name": "Locke at Hunter",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8827367298478",
      "lat": "43.2628018805713",
      "name": "Locke at Napier",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8819495909127",
      "lat": "43.2659146108256",
      "name": "York at Inchbury",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8836993988543",
      "lat": "43.2488085584277",
      "name": "Aberdeen at Queen",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.88208532333374",
      "lat": "43.251408642220426",
      "name": "Herkimer at Queen",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8819466027797",
      "lat": "43.2540651616154",
      "name": "Ryerson Recreation Centre",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.87889617681503",
      "lat": "43.255383107655966",
      "name": "Hunter at Hess",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.877606006297",
      "lat": "43.2618861338306",
      "name": "Queen at Peter",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8777937889099",
      "lat": "43.26456372689135",
      "name": "Oxford at York",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8765896596649",
      "lat": "43.2498930603697",
      "name": "Durand Park",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8720555723035",
      "lat": "43.2496354495324",
      "name": "James S at Charlton",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8753935613187",
      "lat": "43.2538302267771",
      "name": "Bay at Bold",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8744987564414",
      "lat": "43.2561324863605",
      "name": "City Hall",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8729990705895",
      "lat": "43.2597759765548",
      "name": "Bay at York",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.87180307507515",
      "lat": "43.263198441574474",
      "name": "Bay at Mulberry",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8679232597351",
      "lat": "43.26785864558976",
      "name": "Bay at Strachan",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.87132698297499",
      "lat": "43.269288276229105",
      "name": "Bayfront Park",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9234422627427",
      "lat": "43.2495181157076",
      "name": "Ainslie at Emerson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8594326469212",
      "lat": "43.2656936955384",
      "name": "Strachan at Mary",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.861626657542",
      "lat": "43.2701169222876",
      "name": "Hughson at Picton",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86029773950577",
      "lat": "43.27606684636728",
      "name": "Discovery Drive",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.856711442486",
      "lat": "43.271621271914",
      "name": "Eastwood Arena",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8677950761702",
      "lat": "43.2496648107707",
      "name": "Catherine at Young",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.87145036458969",
      "lat": "43.25586951986928",
      "name": "Main at Macnab",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8582423171631",
      "lat": "43.262056982995",
      "name": "Ferguson at Barton",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.85489845275879",
      "lat": "43.266617945064255",
      "name": "Ferrie at Furguson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8598228455297",
      "lat": "43.2587508364231",
      "name": "Ferguson at Cannon",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8614431097373",
      "lat": "43.2551792486624",
      "name": "Ferguson at King William",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86580431461334",
      "lat": "43.257359011015176",
      "name": "King William at John",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.853318631649",
      "lat": "43.26124519046125",
      "name": "Victoria at Barton",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8513960078799",
      "lat": "43.2567834448025",
      "name": "Cannon at Oak",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.85186353325844",
      "lat": "43.24487936776345",
      "name": "Wentworth Steps",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8550984051804",
      "lat": "43.2480282225403",
      "name": "Stinson at Blythe",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86318781971931",
      "lat": "43.251798383773966",
      "name": "Hunter at Furguson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8641461491451",
      "lat": "43.2492552510953",
      "name": "Corktown Park",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.859726111821",
      "lat": "43.2494985579078",
      "name": "Stinson at West",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.85582381486893",
      "lat": "43.254154362311304",
      "name": "King William at Victoria",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8455311859786",
      "lat": "43.2590802780708",
      "name": "Barton at Wentworth",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8475054418754",
      "lat": "43.2559617394464",
      "name": "Cannon at Wentworth - 96",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.84910354018211",
      "lat": "43.25199038416551",
      "name": "Wentworth at King",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86627101898192",
      "lat": "43.272362258983364",
      "name": "Bay at Macaulay",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86883386969566",
      "lat": "43.2523698048509",
      "name": "Haymarket at Hughson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8660421593136",
      "lat": "43.2637774120007",
      "name": "James at Colbourne",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86223563551903",
      "lat": "43.25400491861888",
      "name": "Ferguson at King",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.84128892421722",
      "lat": "43.25504613306136",
      "name": "Cannon at Birch (Powell Park)",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8374917817979",
      "lat": "43.2533992835566",
      "name": "Cannon at Sherman",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8495236914621",
      "lat": "43.2480454302898",
      "name": "Delaware at Myrtle",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.83708053827286",
      "lat": "43.245150946389735",
      "name": "Maplewood at Springer",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.83040988445282",
      "lat": "43.24344818701565",
      "name": "Gage Park",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91978779435158",
      "lat": "43.258038792898375",
      "name": "McMaster Emerson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.922358671032",
      "lat": "43.2599690032886",
      "name": "McMaster Arthur Bourns",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91824820637703",
      "lat": "43.26053126154136",
      "name": "McMaster Health Sciences",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.92224670946598",
      "lat": "43.262460120020584",
      "name": "McMaster Mary Keyes",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91868138313293",
      "lat": "43.26462232214244",
      "name": "McMaster Stadium",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86948698759079",
      "lat": "43.25343546641674",
      "name": "Hunter GO Centre",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91714715957642",
      "lat": "43.26274333966465",
      "name": "McMaster Student Centre",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86919194459914",
      "lat": "43.25901059433612",
      "name": "York at Macnab",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8749090863127",
      "lat": "43.2515957745917",
      "name": "Park at Robinson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8561337635964",
      "lat": "43.257877862291",
      "name": "West at Cannon",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8859572264425",
      "lat": "43.2552015794511",
      "name": "Melbourne at Locke",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8945270389426",
      "lat": "43.2729912871819",
      "name": "Princess Point",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.899692892407",
      "lat": "43.2526283084979",
      "name": "Aberdeen at Studholme",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8733946157064",
      "lat": "43.2543192007999",
      "name": "Hunter at Park",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86718028783798",
      "lat": "43.254529435061336",
      "name": "John at Main",
      "desc": "Blade racks",
      "haskiosk": "No"
    },
    {
      "long": "-79.87721174955368",
      "lat": "43.259125842121065",
      "name": "Hess at king",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.9298771288198",
      "lat": "43.2554850097816",
      "name": "Rifle Range at Rail Trail",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86898005008698",
      "lat": "43.251632328780424",
      "name": "Augusta at John",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8793575167656",
      "lat": "43.25812181171754",
      "name": "Queen at George",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86189499497414",
      "lat": "43.25943154069734",
      "name": "Mary at Cannon",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91580605506897",
      "lat": "43.26271404114188",
      "name": "Forsyth at Sterling",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8713980615139",
      "lat": "43.251734892170504",
      "name": "Duke at James",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86726745963097",
      "lat": "43.25717148364292",
      "name": "King William at Hughson",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.85307991504669",
      "lat": "43.25191559879094",
      "name": "Tisdale at Main",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.89262372255325",
      "lat": "43.25940517059312",
      "name": "Frid at Main",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86148595809937",
      "lat": "43.273843535067726",
      "name": "James at Guise",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.83134329318999",
      "lat": "43.25161474646046",
      "name": "Stadium",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86539393663406",
      "lat": "43.266030544377564",
      "name": "West Harbour GO Station",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86689731478691",
      "lat": "43.27260051521549",
      "name": "Pier 4",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.7663875669241",
      "lat": "43.26000777328068",
      "name": "Van Wagners",
      "desc": "",
      "haskiosk": "Yes"
    },
    {
      "long": "-79.86008584499359",
      "lat": "43.25281814686537",
      "name": "Main and Wellington",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.84050840139389",
      "lat": "43.24333095563425",
      "name": "Cumberland at Blake ",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.84201848506926",
      "lat": "43.24814116192469",
      "name": "Main at Eastbourne",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8180502653122",
      "lat": "43.2475653052787",
      "name": "Cannon at Ottawa",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.86437804996967",
      "lat": "43.25519606248058",
      "name": "King at Mary",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.83437284827232",
      "lat": "43.26044140942891",
      "name": "270 Sherman",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91574570536613",
      "lat": "43.26471509784132",
      "name": "Athletic Centre Bike Racks",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.95375394821166",
      "lat": "43.26595632543361",
      "name": "King Street Dundas",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.94765996932983",
      "lat": "43.26547419149645",
      "name": "Cootes Drive Dundas",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.84364993870258",
      "lat": "43.26534015820083",
      "name": "Mars at Wentworth - ERI01",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.83628392219543",
      "lat": "43.25632467316046",
      "name": "Sherman at Barton - ERI02",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.83144521713257",
      "lat": "43.2552894386678",
      "name": "Barton at Lottridge - ERI03",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.82217215001583",
      "lat": "43.252910500996364",
      "name": "Barton and Belview - ERI05",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.81602117419243",
      "lat": "43.25147804372769",
      "name": "Barton at Ottawa - ERI06",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.81923043727875",
      "lat": "43.2444465978823",
      "name": "Ottawa at Dunsmure - ERI07",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8250025510788",
      "lat": "43.24216273334376",
      "name": "Maple at Rothsay - ERI08",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.82685998082161",
      "lat": "43.24634382646498",
      "name": "King at Dunsmure - ERI09",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.8388883471489",
      "lat": "43.24943274108067",
      "name": "Dunsmure at Sherman - ERI10",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.82740849256516",
      "lat": "43.25112644429895",
      "name": "Gage at Cannon - ERI11",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.82342541217804",
      "lat": "43.248928499066146",
      "name": "Belview at Cannon - ERI12",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.84240606427193",
      "lat": "43.25831920066756",
      "name": "Westinghouse at Barton - ERI13",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.87894982099533",
      "lat": "43.25851444036409",
      "name": "George Street",
      "desc": "Sponsored hub. Installed 2018-02-12",
      "haskiosk": "No"
    },
    {
      "long": "-79.86765705049038",
      "lat": "43.259782164331156",
      "name": "James at Vine",
      "desc": "",
      "haskiosk": "No"
    },
    {
      "long": "-79.91383865476678",
      "lat": "43.25802547698811",
      "name": "Main at Dalewood",
      "desc": "Blade Racks",
      "haskiosk": "No"
    }
  ];

// Custom infobox template. //
var infoboxTemplate = `
<div id='infoboxText'>
    <div class="float-left ignorePad"> <a class="btn btn-danger" href="javascript:void(0)" onclick="(function(){infobox.setOptions({visible: false}) })();"> x </a> </div> 
    <div> {headerContent}  </div>
    <div> {bodyContent} </div>
    <div><a onclick="copyToClipboard(infobox)" href="#"> Copy Point Data To Clipboard </a> </div>    
</div>`

var neighbourhoods = {
    'Corktown': { 'lat': 43.25064, 'long': -79.8688537 },
    'Durand': { 'lat': 43.2505135, 'long': -79.8813224 },
    'Stinson': { 'lat': 43.2484642, 'long': -79.8587936 },
    'St. Clair': { 'lat': 43.245084, 'long': -79.8498687 },
    'Blakely': { 'lat': 43.2424412, 'long': -79.8450937 },
    'Crown Point West': { 'lat': 43.2495557, 'long': -79.8274351 },
    'Stipley': { 'lat': 43.2525073, 'long': -79.8380327 },
    'Gibson': { 'lat': 43.2547057, 'long': -79.8509757 },
    'Landsdale': { 'lat': 43.2571312, 'long': -79.860832 },
    'Beasly': { 'lat': 43.2596417, 'long': -79.8709197 },
    'Central Hamilton': { 'lat': 43.2596696, 'long': -79.8849231 },
    'Strathcona': { 'lat': 43.2655257, 'long': -79.8930973 },
    'North End': { 'lat': 43.2695871, 'long': -79.8666298 },
    'Industrial Sector A': { 'lat': 43.2686727, 'long': -79.8559718 },
    'Industrial Sector B': { 'lat': 43.2664632, 'long': -79.8459981 },
    'Industrial Sector C': { 'lat': 43.2641137, 'long': -79.8359898 },
    'Industrial Sector D': { 'lat': 43.2618127, 'long': -79.8260227 },
    'Kirkendall North': { 'lat': 43.2547682, 'long': -79.9019685 },
    'Kirkendall South': { 'lat': 43.2468732, 'long': -79.9010126 },
    'Chedoke Park B': { 'lat': 43.2495046, 'long': -79.9144347 },
    'Westdale North': { 'lat': 43.2675922, 'long': -79.9070187 },
    'Westdale South': { 'lat': 43.2614556, 'long': -79.9134973 },
    'Ainslie Wood North': { 'lat': 43.2625552, 'long': -79.9391968 },
    'Ainslie Wood East': { 'lat': 43.2527457, 'long': -79.9257258 },
    'Ainslie Wood': { 'lat': 43.2512792, 'long': -79.9380923 },
    'Dundas': { 'lat': 43.265943, 'long': -79.953666 },
}

var searchContent = `
Currently, the search feature of this app is limited to the
following list of neighbourhoods in Hamilton, ON.
<ul>
    <li>Corktown</li><li>Stinson</li><li>Durand</li><li>St.Clair</li><li>Blakely</li><li>Crown Point West</li><li>Stipley</li><li>Gibson</li><li>Landsdale</li><li>Beasly</li><li>Central Hamilton</li><li>Strathcona</li><li>NorthEnd</li><li>Industrial SectorA</li><li>Industrial SectorB</li><li>Industrial SectorC</li><li>Industrial SectorD</li><li>Kirkendall North</li><li>Kirkendall South</li><li>Chedoke Park B</li><li>Westdale North</li><li>Westdale South</li><li>Ainslie Wood North</li><li>Ainslie Wood East</li><li>Ainslie Wood</li><li>Dundas</li>
</ul>\n
To search, simply type in the search bar and select the 
desired neighbourhood you wish to move the map to.
`

var directionsContent = `
To get the map to show the fastest route between two hubs,
click on the icon for the hub you would like to choose as
your start point and select "Copy Point Data To Clipboard".
Paste the point data from your clipboard into the 'From' 
input above the map.

Follow the same directions to copy another icon's point
data to your clipboard, and paste it into the 'To'
input above the map.

Click the 'Go' button to have the map calculate and overlay
the route created on the map.

You may also select and copy the point data from your 
current location's icon (see legend). 
`

var findHubContent = `
Currently, this map contains all of the known SoBi hubs
in Hamilton, ON. To find a hub, simply navigate the map
on the interface and find your desired SoBi hub.

The closest SoBi hub to your current position has it's
icon highlighted in a green colour, and the closest
SoBi hub with a kiosk has it's icon highlighted in a 
purple colour. All other hubs are marked in a white
coloured icon, and your current location is denoted
by the bicycle rider icon.

Along with the directions finding functionality, this
app can allow you to upgrade your SoBi experience.
`



var minDistance = Number.MAX_SAFE_INTEGER;
var minDistanceKiosk = Number.MAX_SAFE_INTEGER;
var minDistanceIndex;
var minDistanceKioskIndex;
var toCoords;
var fromCoords;

// Uses the Haversine formula to determine the distance in km between two points. //
// Shamelessly stolen from https://stackoverflow.com/questions/27928/calculate-distance-between-two-latitude-longitude-points-haversine-formula //
function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
    var R = 6371; // Radius of the earth in km
    var dLat = deg2rad(lat2 - lat1);
    var dLon = deg2rad(lon2 - lon1);
    var a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2)
        ;
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c; // Distance in km
    return d;
}

// Little helper method that converts degrees to radians. //
function deg2rad(deg) {
    return deg * (Math.PI / 180)
}

function createMap(position, init = false, permission = false, filter = "") {
    // Gets the map div from the DOM. //
    var map = new Microsoft.Maps.Map($("#map")[0], {
        center: position,
        zoom: 16
    });

    // If the user has provided location permissions, populates the map with pushpins and infoboxes. //
    if (permission) {

        // Creates the infobox that will be reused for the map. //
        infobox = new Microsoft.Maps.Infobox(
            new Microsoft.Maps.Location(0, 0),
            {
                title: "temp",
                visible: false,
                autoAlignment: true
            });

        infobox.setMap(map);


        for (var i = 0; i < listHubs.length; i++) {
            var imgSrc = "";
            if (listHubs[i].haskiosk == "Yes") {
                if (i == minDistanceKioskIndex) {
                    imgSrc = 'src/img/purplebikeicon.png';
                }
            }
            else {
                if (i == 0) {
                    imgSrc = 'src/img/usericon.png';
                } else {
                    imgSrc = i == minDistanceIndex ? 'src/img/greenbikeicon.png' : 'src/img/bikeicon.png';

                }
            }


            // Initializes some variables for the pushpin. //
            let location = new Microsoft.Maps.Location(listHubs[i].lat, listHubs[i].long);
            let pushPin = new Microsoft.Maps.Pushpin(location, { icon: imgSrc, anchor: new Microsoft.Maps.Point(12, 39) });
            let title = listHubs[i].name;
            let description = listHubs[i].desc;


            // Sets some metadata for the pushPin. //
            pushPin.metadata = {
                title: title,
                description: description
            };


            // This case handles the user's current location pin. Sets the infobox to just display //
            // "current location" instead of all the other information that the rest do. //
            if (i == 0) {

                // Sets an onclick event handler for the pushpin that changes the infobox content and makes it pop up. //
                Microsoft.Maps.Events.addHandler(pushPin, 'click', function (args) {
                    infobox.setOptions({
                        visible: true,
                        location: args.target.getLocation(),
                        htmlContent: infoboxTemplate.replace('{headerContent}', args.target.metadata.title).replace('{bodyContent}', '')
                    });
                });

                // Pushes the pushpin to the map. //
                map.entities.push(pushPin);
            }

            // This case handles all of the rec centre pushpins. //
            else {

                // If the filter includes the city name of the rec centre. //
                if (listHubs[i].desc.includes(filter)) {

                    //Sets an onclick event handle for the pushpin that changes the infobox content //
                    //(more detail than the user's location pin) and sets it to visible. //
                    Microsoft.Maps.Events.addHandler(pushPin, 'click', function (args) {
                        infobox.setOptions({
                            visible: true,
                            location: args.target.getLocation(),
                            htmlContent: infoboxTemplate.replace(
                                '{headerContent}', args.target.metadata.title).replace(
                                    '{bodyContent}', args.target.metadata.description)

                        });

                    });

                    // Pushes the pushpin to the map. //
                    map.entities.push(pushPin);
                };
            }


        }


    }

    //Load the directions module.
    Microsoft.Maps.loadModule('Microsoft.Maps.Directions', function () {
        //Create an instance of the directions manager.
        directionsManager = new Microsoft.Maps.Directions.DirectionsManager(map);
        directionsManager.showInputPanel('directionsInputContainer');
    });

}

// Callback method for the bing API script. //
function loadMapScenario(init = true, filters = "") {

    navigator.geolocation.getCurrentPosition(

        // Callback function for success in the getCurrentLocation() method. //
        function (position) {
            listHubs.unshift(
                {
                    "long": position.coords.longitude,
                    "lat": position.coords.latitude,
                    "name": "Current Location",
                    "desc": "Current Location",
                    "haskiosk": false
                });



            for (var i = 1; i < listHubs.length; i++) {

                let distance = getDistanceFromLatLonInKm(position.coords.latitude, position.coords.longitude, listHubs[i].lat, listHubs[i].long)

                if (distance < minDistance) {
                    minDistance = distance;
                    minDistanceIndex = i;
                }

                if (listHubs[i].haskiosk == "Yes" && distance < minDistanceKiosk) {
                    minDistanceKiosk = distance;
                    minDistanceKioskIndex = i;
                }

            }

            // Draws the map (this is the default map load method). //
            createMap(new Microsoft.Maps.Location(position.coords.latitude, position.coords.longitude), init, true, filters);
        },




        // Callback function for an error in the getCurrentLocation() method. //
        function (error) {
            // Uses Mohawk College's location if permission is denied. //
            createMap(new Microsoft.Maps.Location(43.2387, -79.8881));
        }
    )


}

$(document).ready(function () {


    $('.modalLink').click(function (e) {
        switch (e.target.text) {
            case 'Search':
                $("#modal-content-body").html("");
                $("#modalTitle").html("");
                $("#modalTitle").html("Search");
                $("#modal-content-body").html(searchContent);
                return;

            case 'Get Directions':
                $("#modal-content-body").html("");
                $("#modalTitle").html("");
                $("#modalTitle").html("Get Directions");
                $("#modal-content-body").html(directionsContent);
                return;

            case 'Find a Hub':
                $("#modal-content-body").html("");
                $("#modalTitle").html("");
                $("#modalTitle").html("Find A Hub");
                $("#modal-content-body").html(findHubContent);
                return;
        }

    });

    $("#searchBox").autocomplete({
        source: function (request, response) {
            var results = $.ui.autocomplete.filter(Object.keys(neighbourhoods), request.term);
            response(results.slice(0, 10));
        },

        select: function (e) {
            var point = neighbourhoods[e.currentTarget.childNodes[0].innerText];
            createMap(new Microsoft.Maps.Location(point.lat, point.long), false, true);
        },
    });

    copyToClipboard = function (e) {
        var $temp = $("<input>");
        $("body").append($temp);
        $temp.val(String(e.getLocation().latitude) + ", " + String(e.getLocation().longitude)).select();
        document.execCommand("copy");
        $temp.remove();
    }
})

